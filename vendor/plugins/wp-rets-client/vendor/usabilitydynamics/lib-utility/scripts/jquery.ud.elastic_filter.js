!new function(a){var b=window.ef_app=jQuery.extend(!0,this,{settings:{account_id:void 0,access_key:void 0,per_page:10,debug:!1,visual_debug:!1,url:"https://cloud.usabilitydynamics.com",index:""},documents:[],facets:[],sort_options:[],defaults:null,state:"loading",query:{full_text:null,field:[],terms:[],range:[],fuzzy:[],from:0},size:0,sort:null,bindings_initialized:[],total:null,message:"",elastic_ready:!1,session_id:null,global:window.__elastic_filter={},ready:function(){},_required:{io:"//ud-cdn.com/js/ud.socket/1.0.0/ud.socket.js","ko.mapping":"//ud-cdn.com/js/knockout.mapping/2.3.2/knockout.mapping.js",async:"//ud-cdn.com/js/async/1.0/async.js","ud.ko":"//ud-cdn.com/js/knockout.ud/1.0/knockout.ud.js","ud.select":"//ud-cdn.com/js/ud.select/3.2/ud.select.js","jq-lazyload":"//ud-cdn.com/js/jquery.lazyload/1.8.2/jquery.lazyload.js"},_log:{subscriptions:{},search:[],debug:[],profilers:{}}},a);b._document=function(a){return a},b._facet=function(a,c){var d=[];for(var e in a.terms)d.push({text:a.terms[e].term,id:a.terms[e].term});return a._label=c,a.options=ko.observableArray(d),a.value=ko.observable(),a.select_multiple=ko.observableArray(),a.select_multiple.subscribe(function(a){if(b.view_model.query.terms.remove(ko.utils.arrayFirst(b.view_model.query.terms(),function(a){return"undefined"!=typeof a[c]})),a.length){var d={};d[c]=a,b.view_model.query.terms.push(d)}b.view_model.size(parseInt(b.view_model.settings.per_page())),b.search_request()}),a.css_class=ko.computed(function(){var b="undefined"!=typeof a.options()?a.options().length:0,d=1==b?"eff_single_option":b?"eff_options_"+b:"eff_no_options";return d+" ef_facet_"+c.replace(" ","_")}),a},b.profile=function(a,c,d){if(b._log.profilers[a]&&c){var e=["Profiler",a,c,((new Date).getTime()-b._log.profilers[a])/1e3];return d&&e.push(d),b.log.apply(this,e)}return b._log.profilers[a]=(new Date).getTime(),this},b.log=function(){return"undefined"==typeof console?arguments?arguments:null:arguments[0]instanceof Error?(console.error("ElasticFilter Fatal Error:",arguments[0].message),arguments):(console.log(arguments),arguments?arguments:null)},b.debug=function(){return b._log.debug.push({time:(new Date).getTime(),data:arguments}),ko.utils.unwrapObservable(b.settings.debug)||arguments[0]instanceof Error?b.log.apply(this,arguments):arguments},b.init=function(){return c.back_support(),b.debug("init"),async.auto({binding_handlers:[function(a){return b.debug("init","auto","binding_handlers"),"object"!=typeof ko?a(new Error("Missing Knockout.")):"object"!=typeof io?a(b.debug(new Error("Missing Socket.io."))):(ko.bindingHandlers["elastic-filter"]={init:function(a,c){b.log("binding_handlers","elastic-filter","init"),ko.mapping.fromJS({settings:jQuery.extend(!0,{},b.settings,ko.utils.unwrapObservable(c()))},b.view_model),b.bindings_initialized.push("elastic-filter")}},ko.bindingHandlers["fulltext-search"]={init:function(a,c,d){return b.debug("binding_handlers","fulltext-search","init"),"undefined"==typeof jQuery().select2?new Error("Select2 library is required for Fulltext Search feature"):(jQuery(a).select2(c()),"undefined"!=typeof d().elastic_settings&&ko.mapping.fromJS({settings:d().elastic_settings},b.view_model),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){jQuery(a).select2("destroy")}),void b.bindings_initialized.push("fulltext-search"))}},a(null,[ko.bindingHandlers]))}],observable:["binding_handlers",function(a){return b.debug("init","auto","observable"),b.view_model=ko.mapping.fromJS(b,{ignore:c.get_methods(b).concat("_log","_required","model_functions","facet_functions","document_functions","utils","success","global")}),ko.applyBindings(b.view_model),jQuery.extend(!0,b.view_model,b.facet_functions,b.document_functions),a(null,b)}],socket:["observable",function(a){return b.debug("init","auto","socket"),b.bindings_initialized.length?"undefined"==typeof b.view_model.settings.account_id||"undefined"==typeof b.view_model.settings.access_key?a(new Error("Empty credentials.")):void ud.socket.connect(ko.utils.unwrapObservable(b.view_model.settings.url),{resource:"websocket.api/1.5","account-id":ko.utils.unwrapObservable(b.view_model.settings.account_id),"access-key":ko.utils.unwrapObservable(b.view_model.settings.access_key)},function(c,d){return b.socket=d,c?a(c):(b.socket.once("reconnect",function(){b.debug(new Error("Reconnecting, re-initializing ElasticFilter.").arguments),b.init()}),b.view_model.session_id(b.socket.sessionid),a(null,b.socket))}):void 0}],settings:["socket",function(a){b.debug("init","auto","settings"),b.socket.request("get","api/v1/settings",function(c,d){return b.log("settings",d),c||!d?a(b.log(c||new Error("Request for index settings returned no results."))):(ko.mapping.fromJS({settings:d.settings},b.view_model),b.ready(),a(null,b.settings))})}],ready:["settings",function(a,c){b.debug("init","auto","ready",c),b.view_model.sort(ko.mapping.toJS(b.view_model.settings.defaults.sort)),b.view_model.size(parseInt(b.view_model.settings.per_page())),-1!==b.bindings_initialized.indexOf("elastic-filter")&&b.search_request(),b.view_model.elastic_ready(!0),a(null,b.view_model.elastic_ready())}]},b.initialized),this},b.search_request=function(a){b.profile("search_request");var d={index:b.view_model.settings.index(),query:jQuery.extend(!0,{match_all:{}},ko.mapping.toJS(b.view_model.query)),facets:ko.mapping.toJS(b.view_model.settings.facets),size:b.view_model.size(),sort:b.view_model.sort()};d=c.clean_object(d),b.computed_query=function(){return d},b.log("search_request_data","Data Before Send",d),b.view_model.state("loading"),b.socket.request("post","api/v1/search",d,function(c,d){b.last_response=function(){return d},b.profile("search_request","Have Cloud Response.",d),b.profile("search_request","Request Mapping Start.");var e=[];jQuery.each("undefined"!=typeof d.documents?d.documents:[],function(){e.push(arguments[1])}),b.view_model.documents(ko.utils.arrayMap(e,function(a){return new b._document(a)}));for(var f in"undefined"!=typeof d.meta.facets?d.meta.facets:{}){var g=!1;ko.utils.arrayForEach(b.view_model.facets(),function(a){f==a._label&&(g=!0)}),g||b.view_model.facets.push(new b._facet(d.meta.facets[f],f))}return b.view_model.total("undefined"!=typeof d.meta.total?d.meta.total:0),b.view_model.state("ready"),b.profile("search_request","Request Mapping Complete."),"function"==typeof a?a(c,d):d})},b.custom_search=function(a){b.profile("custom_search_start");var c={index:b.view_model.settings.index(),query:{query_string:{query:b.view_model.query.full_text()}},size:b.view_model.size(),sort:b.view_model.sort()};return b.socket.request("post","api/v1/search",c,a),b.profile("custom_search_end"),!0},b.get_json=function(){return JSON.parse(ko.mapping.toJSON(b.view_model))},b.initialized=function(a,c){return b.debug("initialized",arguments),b.initialization=b.log(a?"Initializaiton Failed.":"Initializaiton Done.",c?c:a),"function"==typeof b.ready&&b.ready(b,a,c),b.initialization},b.facet_functions={facet_after_render:function(){},facet_before_remove:function(a){ko.removeNode(a)},facet_after_add:function(){},facet_template:function(a){var c=[];switch(a&&a._type){case"terms":c.push("template-facet-terms")}return c.push("template-default-facet"),b.model_functions._get_template(c)},submit_facets:function(){b.debug("facet_functions","submit_facets"),b.view_model.size(parseInt(b.view_model.settings.per_page())),b.search_request()}},b.document_functions={document_after_render:function(){},document_before_remove:function(a){ko.removeNode(a)},document_after_add:function(){},document_template:function(){return b.model_functions._get_template(["template-default-document"])},sort_by:function(a,c){b.debug("document_functions","sort"),jQuery(c.target).trigger("sort",[a]);var d=jQuery(c.target).data("field"),e=ko.utils.arrayFirst(a.sort_options,function(a){return"undefined"!=typeof a[d]});if(b.view_model.sort()){var f="undefined"!=typeof b.view_model.sort()[d]?b.view_model.sort()[d]:!1;f&&(e[d].order="desc"==b.view_model.sort()[d].order?"asc":"desc")}b.view_model.sort(e),b.view_model.size(parseInt(b.view_model.settings.per_page())),b.search_request()},is_active_sort:function(a){return b.view_model.sort()&&"undefined"!=typeof b.view_model.sort()[a]?"active":"disabled"},have_more:function(){return b.debug("document_functions","have_more()"),b.have_more=ko.computed({owner:this,read:function(){return b.view_model.total()>b.view_model.documents().length?!0:!1}}),b.have_more()},load_more:function(){b.debug("document_functions","load_more()"),b.view_model.size(parseInt(b.view_model.size())+parseInt(b.view_model.settings.per_page())),b.search_request()}},b.model_functions={_get_template:function(a){for(i in a?a:[])if(document.getElementById(a[i]))return a[i];return a[0]},_remove_item:function(a,b){var c=this[a];ko.utils.arrayFirst(c,function(a){a&&parseInt(a.id)===parseInt(b)&&(c.remove(document),ko.utils.arrayRemoveItem(a))})}};var c=b.utilis={back_support:function(){Object.keys=Object.keys||function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()},get_methods:function(a){var b=jQuery.map(a,function(a,b){return"function"==typeof a?b:void 0});return b},json_editor:function(){ud.load.js({JSONEditor:"http://ud-cdn.com/js/ud.json.editor.js"},function(){ud.load.css("http://ud-cdn.com/js/assets/ud.json.editor.css"),b.json_editor=new JSONEditor(jQuery(".elastic_json_editor").get(0),{indentation:2,search:!1,history:!1})})},contains:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},clean_object:function(a,b){jQuery.extend(!0,{strip_values:[]},b);for(i in a)a[i]||delete a[i],null===a[i]&&delete a[i],"object"==typeof a[i]&&(Object.keys(a[i]).length?a[i]=c.clean_object(a[i],b):delete a[i]);return a}};return ud.load.js(b._required,function(){jQuery(document).trigger("elastic_filter::initialize")}),this};